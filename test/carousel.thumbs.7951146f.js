const M=(r,...t)=>{const e=t.length;for(let i=0;i<e;i++){const o=t[i]||{};Object.entries(o).forEach(([s,n])=>{const a=Array.isArray(n)?[]:{};var l;r[s]||Object.assign(r,{[s]:a}),typeof(l=n)=="object"&&l!==null&&l.constructor===Object&&Object.prototype.toString.call(l)==="[object Object]"?Object.assign(r[s],M(a,n)):Array.isArray(n)?Object.assign(r,{[s]:[...n]}):Object.assign(r,{[s]:n})})}return r},C=function(r){var t=new DOMParser().parseFromString(r,"text/html").body;if(t.childElementCount>1){for(var e=document.createElement("div");t.firstChild;)e.appendChild(t.firstChild);return e}return t.firstChild},S=r=>`${r||""}`.split(" ").filter(t=>!!t),u=(r,t)=>{r&&S(t).forEach(e=>{r.classList.add(e)})},O=(r,t,e)=>{S(t).forEach(i=>{r&&r.classList.toggle(i,e||!1)})},y=function(r,t){return r.split(".").reduce((e,i)=>typeof e=="object"?e[i]:void 0,t)};class v{constructor(t={}){Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.setOptions(t);for(const e of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))e.startsWith("on")&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}setOptions(t){this.options=t?M({},this.constructor.defaults,t):{};for(const[e,i]of Object.entries(this.option("on")||{}))this.on(e,i)}option(t,...e){let i=y(t,this.options);return i&&typeof i=="function"&&(i=i.call(this,this,...e)),i}optionFor(t,e,i,...o){let s=y(e,t);var n;typeof(n=s)!="string"||isNaN(n)||isNaN(parseFloat(n))||(s=parseFloat(s)),s==="true"&&(s=!0),s==="false"&&(s=!1),s&&typeof s=="function"&&(s=s.call(this,this,t,...o));let a=y(e,this.options);return a&&typeof a=="function"?s=a.call(this,this,t,...o,s):s===void 0&&(s=a),s===void 0?i:s}cn(t){const e=this.options.classes;return e&&e[t]||""}localize(t,e=[]){t=String(t).replace(/\{\{(\w+).?(\w+)?\}\}/g,(i,o,s)=>{let n="";return s?n=this.option(`${o[0]+o.toLowerCase().substring(1)}.l10n.${s}`):o&&(n=this.option(`l10n.${o}`)),n||(n=i),n});for(let i=0;i<e.length;i++)t=t.split(e[i][0]).join(e[i][1]);return t=t.replace(/\{\{(.*?)\}\}/g,(i,o)=>o)}on(t,e){let i=[];typeof t=="string"?i=t.split(" "):Array.isArray(t)&&(i=t),this.events||(this.events=new Map),i.forEach(o=>{let s=this.events.get(o);s||(this.events.set(o,[]),s=[]),s.includes(e)||s.push(e),this.events.set(o,s)})}off(t,e){let i=[];typeof t=="string"?i=t.split(" "):Array.isArray(t)&&(i=t),i.forEach(o=>{const s=this.events.get(o);if(Array.isArray(s)){const n=s.indexOf(e);n>-1&&s.splice(n,1)}})}emit(t,...e){[...this.events.get(t)||[]].forEach(i=>i(this,...e)),t!=="*"&&this.emit("*",t,...e)}}Object.defineProperty(v,"version",{enumerable:!0,configurable:!0,writable:!0,value:"5.0.19"}),Object.defineProperty(v,"defaults",{enumerable:!0,configurable:!0,writable:!0,value:{}});class w extends v{constructor(t,e){super(e),Object.defineProperty(this,"instance",{enumerable:!0,configurable:!0,writable:!0,value:t})}attach(){}detach(){}}var f,P;(function(r){r[r.Init=0]="Init",r[r.Error=1]="Error",r[r.Ready=2]="Ready",r[r.Panning=3]="Panning",r[r.Mousemove=4]="Mousemove",r[r.Destroy=5]="Destroy"})(f||(f={})),function(r){r[r.Init=0]="Init",r[r.Ready=1]="Ready",r[r.Destroy=2]="Destroy"}(P||(P={}));const A=(r,t=1e4)=>(r=parseFloat(r+"")||0,Math.round((r+Number.EPSILON)*t)/t),j={classes:{container:"f-thumbs f-carousel__thumbs",viewport:"f-thumbs__viewport",track:"f-thumbs__track",slide:"f-thumbs__slide",isResting:"is-resting",isSelected:"is-selected",isLoading:"is-loading",hasThumbs:"has-thumbs"},minCount:2,parentEl:null,thumbTpl:'<button class="f-thumbs__slide__button" tabindex="0" type="button" aria-label="{{GOTO}}" data-carousel-index="%i"><img class="f-thumbs__slide__img" data-lazy-src="{{%s}}" alt="" /></button>',type:"modern"};var d;(function(r){r[r.Init=0]="Init",r[r.Ready=1]="Ready",r[r.Hidden=2]="Hidden",r[r.Disabled=3]="Disabled"})(d||(d={}));class x extends w{constructor(){super(...arguments),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"modern"}),Object.defineProperty(this,"container",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"track",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"carousel",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"panzoom",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"thumbWidth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"thumbClipWidth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"thumbHeight",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"thumbGap",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"thumbExtraGap",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"shouldCenter",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:d.Init})}formatThumb(t,e){return this.instance.localize(e,[["%i",t.index],["%d",t.index+1],["%s",t.thumbSrc||"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"]])}getSlides(){const t=[],e=this.option("thumbTpl")||"";if(e)for(const i of this.instance.slides||[]){let o="";i.type&&(o=`for-${i.type}`,i.type&&["video","youtube","vimeo","html5video"].includes(i.type)&&(o+=" for-video")),t.push({html:this.formatThumb(i,e),customClass:o})}return t}onInitSlide(t,e){const i=e.el;i&&(e.thumbSrc=i.dataset.thumbSrc||e.thumbSrc||"",e.thumbClipWidth=parseFloat(i.dataset.thumbClipWidth||"")||e.thumbClipWidth||0,e.thumbHeight=parseFloat(i.dataset.thumbHeight||"")||e.thumbHeight||0)}onInitSlides(){this.state===d.Init&&this.build()}onRefreshM(){this.refreshModern()}onChangeM(){this.type==="modern"&&(this.shouldCenter=!0,this.centerModern())}onClickModern(t){t.preventDefault(),t.stopPropagation();const e=this.instance,i=e.page,o=a=>{if(a){const l=a.closest("[data-carousel-index]");if(l)return parseInt(l.dataset.carouselIndex||"",10)||0}return-1},s=(a,l)=>{const h=document.elementFromPoint(a,l);return h?o(h):-1};let n=o(t.target);n<0&&(n=s(t.clientX+this.thumbGap,t.clientY),n===i&&(n=i-1)),n<0&&(n=s(t.clientX-this.thumbGap,t.clientY),n===i&&(n=i+1)),n<0&&(n=(a=>{let l=s(t.clientX-a,t.clientY),h=s(t.clientX+a,t.clientY);return n<0&&l===i&&(n=i+1),n<0&&h===i&&(n=i-1),n})(this.thumbExtraGap)),n===i?this.centerModern():n>-1&&n<e.pages.length&&e.slideTo(n)}onTransformM(){if(this.type!=="modern")return;const{instance:t,container:e,track:i}=this,o=t.panzoom;if(!(e&&i&&o&&this.panzoom))return;O(e,this.cn("isResting"),o.state!==f.Init&&o.isResting);const s=this.thumbGap,n=this.thumbExtraGap,a=this.thumbClipWidth;let l=0,h=0,c=0;for(const m of t.slides){let p=m.index,b=m.thumbSlideEl;if(!b)continue;O(b,this.cn("isSelected"),p===t.page),h=1-Math.abs(t.getProgress(p)),b.style.setProperty("--progress",h?h+"":"");const g=.5*((m.thumbWidth||0)-a);l+=s,l+=g,h&&(l-=h*(g+n)),b.style.setProperty("--shift",l-s+""),l+=g,h&&(l-=h*(g+n)),l-=s,p===0&&(c=n*h)}i&&(i.style.setProperty("--left",c+""),i.style.setProperty("--width",l+c+s+n*h+"")),this.shouldCenter&&this.centerModern()}buildClassic(){const{container:t,track:e}=this,i=this.getSlides();if(!t||!e||!i)return;const o=new this.instance.constructor(t,M({track:e,infinite:!1,center:!0,fill:!0,dragFree:!0,slidesPerPage:1,transition:!1,Dots:!1,Navigation:!1,classes:{container:"f-thumbs",viewport:"f-thumbs__viewport",track:"f-thumbs__track",slide:"f-thumbs__slide"}},this.option("Carousel")||{},{Sync:{target:this.instance},slides:i}));this.carousel=o,this.track=e,o.on("ready",()=>{this.emit("ready")}),o.on("createSlide",(s,n)=>{this.emit("createSlide",n,n.el)})}buildModern(){if(this.type!=="modern")return;const{container:t,track:e,instance:i}=this,o=this.option("thumbTpl")||"";if(!t||!e||!o)return;u(t,"is-horizontal"),this.updateModern();for(const n of i.slides||[]){const a=document.createElement("div");if(u(a,this.cn("slide")),n.type){let l=`for-${n.type}`;["video","youtube","vimeo","html5video"].includes(n.type)&&(l+=" for-video"),u(a,l)}a.appendChild(C(this.formatThumb(n,o))),this.emit("createSlide",n,a),n.thumbSlideEl=a,e.appendChild(a),this.resizeModernSlide(n)}const s=new i.constructor.Panzoom(t,{content:e,lockAxis:"x",zoom:!1,panOnlyZoomed:!1,bounds:()=>{let n=0,a=0,l=i.slides[0],h=i.slides[i.slides.length-1],c=i.slides[i.page];return l&&h&&c&&(a=-1*this.getModernThumbPos(0),i.page!==0&&(a+=.5*(l.thumbWidth||0)),n=-1*this.getModernThumbPos(i.slides.length-1),i.page!==i.slides.length-1&&(n+=(h.thumbWidth||0)-(c.thumbWidth||0)-.5*(h.thumbWidth||0))),{x:{min:n,max:a},y:{min:0,max:0}}}});s.on("touchStart",(n,a)=>{this.shouldCenter=!1}),s.on("click",(n,a)=>this.onClickModern(a)),s.on("ready",()=>{this.centerModern(),this.emit("ready")}),s.on(["afterTransform","refresh"],n=>{this.lazyLoadModern()}),this.panzoom=s,this.refreshModern()}updateModern(){if(this.type!=="modern")return;const{container:t}=this;t&&(this.thumbGap=parseFloat(getComputedStyle(t).getPropertyValue("--f-thumb-gap"))||0,this.thumbExtraGap=parseFloat(getComputedStyle(t).getPropertyValue("--f-thumb-extra-gap"))||0,this.thumbWidth=parseFloat(getComputedStyle(t).getPropertyValue("--f-thumb-width"))||40,this.thumbClipWidth=parseFloat(getComputedStyle(t).getPropertyValue("--f-thumb-clip-width"))||40,this.thumbHeight=parseFloat(getComputedStyle(t).getPropertyValue("--f-thumb-height"))||40)}refreshModern(){var t;if(this.type==="modern"){this.updateModern();for(const e of this.instance.slides||[])this.resizeModernSlide(e);this.onTransformM(),(t=this.panzoom)===null||t===void 0||t.updateMetrics(!0),this.centerModern(0)}}centerModern(t){const e=this.instance,{container:i,panzoom:o}=this;if(!i||!o||o.state===f.Init)return;const s=e.page;let n=this.getModernThumbPos(s),a=n;for(let h=e.page-3;h<e.page+3;h++){if(h<0||h>e.pages.length-1||h===e.page)continue;const c=1-Math.abs(e.getProgress(h));c>0&&c<1&&(a+=c*(this.getModernThumbPos(h)-n))}let l=100;t===void 0&&(t=.2,e.inTransition.size>0&&(t=.12),Math.abs(-1*o.current.e-a)>o.containerRect.width&&(t=.5,l=0)),o.options.maxVelocity=l,o.applyChange({panX:A(-1*a-o.target.e,1e3),friction:e.prevPage===null?0:t})}lazyLoadModern(){const{instance:t,panzoom:e}=this;if(!e)return;const i=-1*e.current.e||0;let o=this.getModernThumbPos(t.page);if(e.state!==f.Init||o===0)for(const s of t.slides||[]){const n=s.thumbSlideEl;if(!n)continue;const a=n.querySelector("img[data-lazy-src]"),l=s.index,h=this.getModernThumbPos(l),c=i-.5*e.containerRect.innerWidth,m=c+e.containerRect.innerWidth;if(!a||h<c||h>m)continue;let p=a.dataset.lazySrc;if(!p||!p.length||(delete a.dataset.lazySrc,a.src=p,a.complete))continue;u(n,this.cn("isLoading"));const b=C('<div class="f-spinner"><svg viewBox="0 0 50 50"><circle cx="25" cy="25" r="20"></circle><circle cx="25" cy="25" r="20"></circle></svg></div>');n.appendChild(b),a.addEventListener("load",()=>{n.offsetParent&&(n.classList.remove(this.cn("isLoading")),b.remove())},!1)}}resizeModernSlide(t){if(this.type!=="modern"||!t.thumbSlideEl)return;const e=t.thumbClipWidth&&t.thumbHeight?Math.round(this.thumbHeight*(t.thumbClipWidth/t.thumbHeight)):this.thumbWidth;t.thumbWidth=e}getModernThumbPos(t){const e=this.instance.slides[t],i=this.panzoom;if(!i||!i.contentRect.fitWidth)return 0;let o=i.containerRect.innerWidth,s=i.contentRect.width;this.instance.slides.length===2&&(t-=1,s=2*this.thumbClipWidth);let n=t*(this.thumbClipWidth+this.thumbGap)+this.thumbExtraGap+.5*(e.thumbWidth||0);return n-=s>o?.5*o:.5*s,A(n||0,1)}build(){const t=this.instance,e=t.container,i=this.option("minCount")||0;if(i){let l=0;for(const h of t.slides||[])h.thumbSrc&&l++;if(l<i)return this.cleanup(),void(this.state=d.Disabled)}const o=this.option("type");if(["modern","classic"].indexOf(o)<0)return void(this.state=d.Disabled);this.type=o;const s=document.createElement("div");u(s,this.cn("container")),u(s,`is-${o}`);const n=this.option("parentEl");n?n.appendChild(s):e.after(s),this.container=s,u(e,this.cn("hasThumbs"));const a=document.createElement("div");u(a,this.cn("track")),s.appendChild(a),this.track=a,o==="classic"?this.buildClassic():this.buildModern(),this.state=d.Ready,s.addEventListener("click",l=>{setTimeout(()=>{var h;(h=s==null?void 0:s.querySelector(`[data-carousel-index="${t.page}"]`))===null||h===void 0||h.focus()},100)})}cleanup(){var t,e;this.carousel&&this.carousel.destroy(),this.carousel=null,this.panzoom&&this.panzoom.destroy(),this.panzoom=null,this.container&&this.container.remove(),this.container=null,this.track=null,this.state=d.Init,t=this.instance.container,e=this.cn("hasThumbs"),t&&S(e).forEach(i=>{t.classList.remove(i)})}attach(){const t=this,e=t.instance;e.on("initSlide",t.onInitSlide),e.state===P.Init?e.on("initSlides",t.onInitSlides):t.onInitSlides(),e.on("Panzoom.afterTransform",t.onTransformM),e.on("Panzoom.refresh",t.onRefreshM),e.on("change",t.onChangeM)}detach(){const t=this,e=t.instance;e.off("initSlide",t.onInitSlide),e.off("initSlides",t.onInitSlides),e.off("Panzoom.afterTransform",t.onTransformM),e.off("Panzoom.refresh",t.onRefreshM),e.off("change",t.onChangeM),t.cleanup()}}Object.defineProperty(x,"defaults",{enumerable:!0,configurable:!0,writable:!0,value:j});export{x as p};